name: Keep Chants Alive

on:
  schedule:
    - cron: '0 0 1 * *'  # Runs at 00:00 UTC on the 1st of every month (adjust if needed)
  workflow_dispatch:  # Allows manual triggering from the GitHub UI for testing

jobs:
  access-urls:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install requests
        run: pip install requests

      - name: Access each chant URL
        run: |
          python -c "
          import json
          import requests
          import time
          with open('chants.prod.json', 'r') as f:
              data = json.load(f)
          for item in data:
              url = item['chanturl']
              try:
                  response = requests.get(url, stream=True)  # Streams to avoid loading full audio into memory
                  print(f'Accessed {url} - Status: {response.status_code}')
              except Exception as e:
                  print(f'Error accessing {url}: {e}')
              time.sleep(1)  # 1-second delay to avoid overwhelming the host
          "
